

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Managing sets of runs with a Campaign &mdash; CosmoSIS 3.3 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=26f62d79"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Python API" href="../api/api_python.html" />
    <link rel="prev" title="Debugging" href="debugging.html" />
    <link href="../_static/style.css" rel="stylesheet" type="text/css">

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            CosmoSIS
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Introduction:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../intro/overview.html">CosmoSIS Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro/installation.html">Installing CosmoSIS</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Using CosmoSIS:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../usage/tutorials.html">Tutorials: Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage/samplers.html">Samplers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage/parameter_files.html">CosmoSIS Parameter Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage/standard_library_overview.html">Standard Library Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage/upgrading.html">Upgrading from the previous CosmoSIS Version</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Bonus Features:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="sampler_features.html">Sampler Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="pipeline_features.html">Pipeline Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="parameter_features.html">Parameter Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="debugging.html">Debugging</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Managing sets of runs with a Campaign</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#file-format">File Format</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#general-settings">General settings</a></li>
<li class="toctree-l3"><a class="reference internal" href="#runs">Runs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#updates-to-runs">Updates to runs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#components">Components</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#using-the-campaign-tool-from-the-command-line">Using the campaign tool from the command line</a></li>
<li class="toctree-l2"><a class="reference internal" href="#using-the-campaign-tool-from-a-python-script-or-jupyter-notebook">Using the campaign tool from a Python script or Jupyter notebook</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Writing modules:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/api_python.html">Python API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/api_c.html">C API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/api_cpp.html">C++ API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/api_f90.html">Fortran API</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../reference/cosmosis_command_line.html">Command line flags for cosmosis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/cosmosis_campaign.html">cosmosis-campaign</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/cosmosis_configure.html">Command line flags for cosmosis-configure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/cosmosis_extract.html">Command line flags for cosmosis-extract</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/cosmosis_sample_fisher.html">Command line flags for cosmosis-sample-fisher</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/postprocess_command_line.html">Command line flags for postprocess</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/standard_library_complete.html">Standard Library Complete Listing</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Misc:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../reference/scripting.html">Scripting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/nersc_examples.html">NERSC Submission Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../help/faq.html">Frequently Asked Questions</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">CosmoSIS</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Managing sets of runs with a Campaign</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/features/campaign.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="managing-sets-of-runs-with-a-campaign">
<h1>Managing sets of runs with a Campaign<a class="headerlink" href="#managing-sets-of-runs-with-a-campaign" title="Link to this heading"></a></h1>
<p>It is common to want to run a suite of related analyses, for
example to explore the effects of different models, priors, or data sets.</p>
<p>CosmoSIS comes with a tool to help you do this, called the
<code class="docutils literal notranslate"><span class="pre">campaign</span></code> module.  This allows you to specify a set of runs
using a YAML file, and then run them individually and check their status.</p>
<p>The command to run and use campaigns is called <code class="docutils literal notranslate"><span class="pre">cosmosis-campaign</span></code>.</p>
<section id="file-format">
<h2>File Format<a class="headerlink" href="#file-format" title="Link to this heading"></a></h2>
<p>The campaign file is in the YAML format. You can find an
<a class="reference external" href="https://github.com/joezuntz/cosmosis-standard-library/blob/main/examples/des-campaign.yml">example campaign file in the CosmoSIS standard library</a>.</p>
<section id="general-settings">
<h3>General settings<a class="headerlink" href="#general-settings" title="Link to this heading"></a></h3>
<p>The file can have four top-level keys:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">runs</span></code> - a list of run definitions, see below.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">components</span></code> - an optional dictionary of reusable components, see below.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">output_dir</span></code> which sets where all outputs from chains are saved. If this is not set then the current directory is used.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">include</span></code> - either a list or a string, this specifies other YAML campaign files to load before the current one.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">output_name</span></code> - a string to use as the format for all output files. This must include the string <code class="docutils literal notranslate"><span class="pre">{name}</span></code> which will be replaced by the name of the run. You can put other things before and after <code class="docutils literal notranslate"><span class="pre">{name}</span></code> to customize the output chain file names.</p></li>
</ul>
</section>
<section id="runs">
<h3>Runs<a class="headerlink" href="#runs" title="Link to this heading"></a></h3>
<p>The file has a top-level key called <code class="docutils literal notranslate"><span class="pre">runs</span></code> which is a list of
runs. Each run has a name, and a dictionary of parameters.</p>
<p>Runs must have:</p>
<ul class="simple">
<li><p>a <code class="docutils literal notranslate"><span class="pre">name</span></code> key which is used to name output files for the run.</p></li>
<li><p>EITHER <code class="docutils literal notranslate"><span class="pre">base</span></code>: specifying an ini format parameter file on disk to run</p></li>
<li><p>OR <code class="docutils literal notranslate"><span class="pre">parent</span></code>: specifying another run to descend from.  The parent run must have been defined earlier in the file.</p>
<ul>
<li><p>a common pattern is to have a single base run, and then a set of runs that are descended from it, making modifications.</p></li>
</ul>
</li>
</ul>
<p>Optionally they may have any of these keys:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">params</span></code>: a dictionary of parameter updates to use for this run.  These will be replace values in the base or parent run.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">values</span></code>:  similar updates to the values file of fixed and varied numerical parameters input to the chain.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">priors</span></code>: similar updates to the priors.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pipeline</span></code>:updates to the list of modules that make up the pipeline.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">components</span></code>: a list of keys to the <code class="docutils literal notranslate"><span class="pre">components</span></code> dictionary (see below).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">env</span></code>:  a dictionary of environment variables to set for this run, both when making the configuration and running the chain.</p></li>
</ul>
</section>
<section id="updates-to-runs">
<h3>Updates to runs<a class="headerlink" href="#updates-to-runs" title="Link to this heading"></a></h3>
<p>Updates to the params, values, or priors modify the settings from the parameter file, and can have either of these forms:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">section.option=value</span></code> to set or replace a single parameter</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">del</span> <span class="pre">section.option</span></code> to delete a parameter</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">del</span> <span class="pre">section</span></code> to delete an entire section</p></li>
</ul>
<p>For example, the update <code class="docutils literal notranslate"><span class="pre">camb.feedback=4</span></code> would change the <code class="docutils literal notranslate"><span class="pre">feedback</span></code> option in the <code class="docutils literal notranslate"><span class="pre">[camb]</span></code> section of the parameter file to <code class="docutils literal notranslate"><span class="pre">4</span></code>.</p>
<p>Additionally, the parameter file only can accept an option of the form:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">sampler=&lt;name</span> <span class="pre">of</span> <span class="pre">sampler&gt;</span></code> to select the sampler to be used. This is shortand for <code class="docutils literal notranslate"><span class="pre">runtime.sampler=&lt;name&gt;</span></code>.</p></li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">pipeline</span></code> key is a list of changes to the “modules” setting in the parameter file, which
specifies the list of CosmoSIS modules to be run to evaluate a likelihood.  The changes can be:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">after</span> <span class="pre">&lt;module&gt;</span> <span class="pre">&lt;new_module&gt;</span> <span class="pre">[&lt;new_module&gt;</span> <span class="pre">...]</span></code> to add one or more modules after an existing one</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">before</span> <span class="pre">&lt;module&gt;</span> <span class="pre">&lt;new_module&gt;</span> <span class="pre">[&lt;new_module&gt;</span> <span class="pre">...]</span></code> to add one or more modules before an existing one</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">replace</span> <span class="pre">&lt;module&gt;</span> <span class="pre">&lt;new_module&gt;</span> <span class="pre">[&lt;new_module&gt;</span> <span class="pre">...]</span></code> to replace a module with one or more new ones</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">del</span> <span class="pre">&lt;module&gt;</span> <span class="pre">[&lt;module&gt;</span> <span class="pre">...]</span></code> to delete a module</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">append</span> <span class="pre">&lt;new_module&gt;</span> <span class="pre">[&lt;new_module&gt;</span> <span class="pre">...]</span></code> to add a new module to the end of the pipeline</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">prepend</span> <span class="pre">&lt;new_module&gt;</span> <span class="pre">[&lt;new_module&gt;</span> <span class="pre">...]</span></code> to add a new module to the start of the pipeline</p></li>
</ul>
</section>
<section id="components">
<h3>Components<a class="headerlink" href="#components" title="Link to this heading"></a></h3>
<p>It’s common to have a set of updates to a pipeline that are used in many runs. For example,
you might have many runs that add a new parameter to the pipeline, such as varying the equation of state <code class="docutils literal notranslate"><span class="pre">w</span></code>.</p>
<p>Rather than repeating the same set of updates in many runs, you can define a component and then refer to it in mulltiple runs.</p>
<p>Components are defined in a dictionary called <code class="docutils literal notranslate"><span class="pre">components</span></code>.  Each component has a name, and a dictionary of updates.
The updates are exact same format as for the runs.</p>
<p>Components are applied before any updates in the runs themselves.</p>
</section>
</section>
<section id="using-the-campaign-tool-from-the-command-line">
<h2>Using the campaign tool from the command line<a class="headerlink" href="#using-the-campaign-tool-from-the-command-line" title="Link to this heading"></a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">cosmosis-campaign</span></code> command is always called with the name of the campaign file described above.</p>
<p>Then it has a number of options:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">--list</span></code> or <code class="docutils literal notranslate"><span class="pre">-l</span></code> lists the names of all the runs in the campaign.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--cat</span> <span class="pre">&lt;name&gt;</span></code> or <code class="docutils literal notranslate"><span class="pre">-c</span> <span class="pre">&lt;name&gt;</span></code> prints the ini files that would be generated for a given run</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--run</span> <span class="pre">&lt;name&gt;</span></code> or <code class="docutils literal notranslate"><span class="pre">-r</span> <span class="pre">&lt;name&gt;</span></code> launches a run.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--test</span> <span class="pre">&lt;name&gt;</span></code> or <code class="docutils literal notranslate"><span class="pre">-t</span> <span class="pre">&lt;name&gt;</span></code> runs a pipeline using the test sampler to check it works.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--status</span></code> or <code class="docutils literal notranslate"><span class="pre">-s</span></code> shows the status of all runs, or a single run if given a name. It checks whether an output file for the run has been generated and how large and recent it is.  Because this option takes an optional argument it must be given after the name of the campaign file.</p></li>
</ul>
<p>If you use the <code class="docutils literal notranslate"><span class="pre">--run</span></code> flag to set a run going then you can also give the <code class="docutils literal notranslate"><span class="pre">--mpi</span></code> flag to run it under MPI. In that case
you should run the whole <code class="docutils literal notranslate"><span class="pre">cosmosis-campaign</span></code> command under MPI, e.g.</p>
<p><code class="docutils literal notranslate"><span class="pre">mpirun</span> <span class="pre">-n</span> <span class="pre">4</span> <span class="pre">cosmosis-campaign</span> <span class="pre">my_campaign.yml</span> <span class="pre">--run</span> <span class="pre">my_run</span> <span class="pre">--mpi</span></code></p>
</section>
<section id="using-the-campaign-tool-from-a-python-script-or-jupyter-notebook">
<h2>Using the campaign tool from a Python script or Jupyter notebook<a class="headerlink" href="#using-the-campaign-tool-from-a-python-script-or-jupyter-notebook" title="Link to this heading"></a></h2>
<p>You can import the campaign module into a script or notebook and use the tools in it to
run and monitor campaigns.</p>
<p>You can import the module <code class="docutils literal notranslate"><span class="pre">cosmosis.campaign</span></code>, and then monitor with the functions:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">parse_yaml_run_file(filename)</span></code> - parse a campaign file.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">show_run(run_info)</span></code> - print the ini information to the screen for the dict specifying the run</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">show_run_status(runs_dict,</span> <span class="pre">[name_of_run])</span></code> - print a summary of the status of all runs, or a single run if given a name.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">launch_run(run,</span> <span class="pre">mpi=False)</span></code> - launch a run, optionally under MPI.</p></li>
</ul>
<p>You can also explore the commands that modify runs and components by looking at the function docstrings in that module.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="debugging.html" class="btn btn-neutral float-left" title="Debugging" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../api/api_python.html" class="btn btn-neutral float-right" title="Python API" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2017, The CosmoSIS Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>